## 웹을 지탱하는 기술

---

- URI



#### URI

---

URI는 Uniform Resource Identifier의 약자로, '유니폼 리소스 식별자'이다.

즉, URI란 '리소스를 통일적으로 식별하는 ID'를 말한다.

통일적이란 모두가 같은 규칙을 따르고 있다는 것이며, 식별자란 어떤 것을 그 밖의 다른 것과 구별하여 가리키기 위한 이름/ID를 말한다.

URI를 사용하면 웹상에 존재하는 모든 리소스를 한결같은 방식으로 보여줄 수 있다.

즉, URI만 있으면 모든 리소스에 간단하게 접속할 수 있게 되는 것이다.



##### URI의 구문

---

우선 기본적인 URI를 살펴보자.

```
http://blog.example.com/entries/1
스키마://호스트명/경로(path)
```

URI는 URI 스키마로 시작된다.

URI 스키마는 그 URI가 사용하는 프로토콜을 나타내는 것이 일반적이다. 

스키마와 그 뒤에 이어지는 부분은 "://"로 구분된다.

다음으로는 호스트명이 나타난다.

호스트명은 DNS에서 이름을 해석할 수 있는 도메인명이나 IP 어드레스로 인터넷에서 반드시 일의성을 가지게 된다.

호스트명 뒤에는 계층화를 나타내는 경로가 이어진다.

경로는 호스트안에서 오르지 하나의 리소스를 가리킨다.



조금더 복잡한 URI를 살펴보면

```
http://user:passwd@blog.example.com:8000/search?q=test&debug=true#n10
스키마://사용자정보@호스트명:포트번호/패스?쿼리파라미터#플래그먼트
```

추가된 부분을 우선 살펴보자.

URI 스키마 다음에 나온 사용자 정보는 이 리소스에 접근할 때 이용할 사용자 이름과 패스워드로 구성된다.

호스트명 이후에 나오는 포트번호는 이 호스트에 액세스 할 때, 프로토콜이 사용할 TCP의 포트번호를 나타낸다.

? 뒤에는 이름=값의 형식으로 된 쿼리가 이어지며 여러개를 사용하려면 '&'로 연결한다.

쿼리 파라미터는 검색 서비스에 검색 키워드를 전달할 때 등 클라이언트에서 동적으로 URI를 생성할 때 사용한다.

플래그먼트는 URI가 가리키는 리소스 내부에서 더 세세한 부분을 특정할때 이용한다.



##### URI 경로

---

URI는 두 가지 방법으로 나타낼 수 있다.

상대 경로와 절대 경로이다.

상대 URI는 URI 스키마와 호스트명을 생략하고, 경로만 표현한다.

상대 URI의 기준이 되는 URI가 어딘지 알 수 없기 때문에 상대 URI만 가지고는 클라이언트가 바르게 해석할 수 없다.

이를 위해 기점이 되는 URI인 Base URI가 필요하다.



Base URI를 지정하는 방법은 HTML의 \<head> 요소 안에 \<base> 요소를 삽입하는 것이다.

```html
<head>
    <base href = "http://example.com"/>
</head>

```



##### URI 속의 문자

---

URI에서 사용할 수 있는 문자는 아래와 같다.

> 알파벳 : A-Z,a-z
>
> 숫자 : 0-9
>
> 기호 : -, ., ~, :, @, !, $, &, ', ()

위 문자열은 소위 ASCII 문자다.



한글이나 일어 등 ASCII 이외의 문자를 URI에 넣을 때는 %인코딩이라는 방식을 이용한다.

%인코딩은 URI 스펙에서 허용하는 문자 이외의 것을 입력하기 위해서 사용하는 방식이다.

%인코딩에서는 UTF-8 문자를 구성하는 각 바이트를 '%xx'로 기술하여 URI에 사용할 수 없는 문자를 표현한다.

%인코딩에 사용하는 문자는 대문자든 소문자든 같은 의미를 가진다.



서버가 제공하는 URI를 그대로 다루는 경우는 서버가 %인코딩하고 있어 문제가 없지만, 클라이언트 쪽에서 폼을 사용해 URI를 생성하는 경우에는 문자가 발생한다.

유저가 입력한 문자를 어느 문자 인코딩을 사용해 %인코딩할 것인지 클라이언트가 판단할 수 없기 때문이다.

이 문제는 일반적으로 그 폼을 제공하고 있는 웹 페이지의 문자 인코딩을 사용함으로써 해결한다.

이 방식은 프록시에서 문자 인코딩을 변환하는 경우나 근본이 되는 웹페이지의 문자 인코딩 범위 외의 문자가 주어진 경우 등에선 오류를 일으킨다.



##### 변하지 않는 URI

---

- 메서드명과 세션ID를 포함하지 않는다.
- 프로그래밍 언어에 의존적인 확장자와 경로를 포함하지 않는다.
  이를 확장자를 사용하면 안된다고 받아드리면 안된다. 하나의 리소스가 복수의 표현을 가질 때, 각 리소스의 표현을 나타내는 URI엔 확장자를 사용하는 것은 나쁜 일이 아니다.
- URI는 리소스를 표현하는 명사로 한다.
  HTTP에서는 리소스에 대해서 특정 HTTP 메서드만 적용한다. 그리고 어떤 리소스를 취득할지 갱신할지는 URI로 지정하는 것이 아니라, URI에 적용하는 HTTP 메서드로 결정한다. 즉 URI와 HTTP 메서드의 관계는 명사와 동사의 관계와 같다. 따라서 URI는 전체저긍로 명사가 되도록 설계해야 하는 것이다.



##### URI를 변경하고 싶을 때

---

URI를 변경해야 할 때는 redirect를 사용하면 된다.

redirect란 오래된 URI를 새로운 URI로 전송하는 HTTP의 기능을 말한다.



##### 매트릭스 URI

---

URI는 슬래시(/)를 사용해 계층을 표현할 수 있다.

하지만, 모든 정보를 계층적으로 관리할 수 있는 것은 아니다.

다차원을 가지는 정보는 계층으로 표현할 수 없다.

여러 파라미터의 조합으로 표현하는 리소스에는 매트릭스 URI를 사용한다.

매트릭스 URI에서는 계층구조를 표현하는 슬래시 대신에 각각의 파라미터를 세미콜론(;)으로 구분해 리소스를 표현한다.

```
http://example.com/map/lat=35.705451;lng=139.751898
```

일반적으로 매트릭스 URI를 표현할 때는 세미콜론(;)이나 콤마(,)가 사용된다.

세미콜론은 파라미터의 순서가 의미를 가지지 않는 경우에, 콤마는 파라미터의 순서가 의미를 가지는 경우에 사용한다.



